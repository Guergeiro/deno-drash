#!/bin/bash

(
  export DRASH_DIR_EXAMPLE_CODE="$DRASH_DIR_ROOT/docs/src/example_code"
  export DRASH_SERVER_DIRECTORY="$DRASH_DIR_ROOT/docs"
  export DRASH_CORE_LOGGER_ENABLED="true"
  export DRASH_CORE_LOGGER_LEVEL="debug"

  for pid in $(ps aux | grep 'docs.ts' | grep 'deno /' | awk '{print $2}'); do
    echo "[watchmedo] Killing $pid"
    kill -9 $pid
    echo "[watchmedo] PID $pid killed."
  done

  if [[ $1 == "restart" ]]; then
    echo -e "[watchmedo] Restarting $DRASH_SERVER_DIRECTORY/docs.ts app..."
  else
    echo -e "[watchmedo] Starting $DRASH_SERVER_DIRECTORY/docs.ts app..."
  fi

  deno $DRASH_DIR_ROOT/docs/docs.ts -A &

  echo -e "[watchmedo] $DRASH_SERVER_DIRECTORY/docs.ts app started.\n"
  echo -e "[watchmedo] !!! IMPORTANT !!!"
  echo -e "[watchmedo] [ctrl] + [c] will NOT kill the docs.ts app. Run the following to kill the app:"
  echo -e "    \`npm run dev-kill\`\n"

  if [[ -z $1 ]]; then
    echo -e "[watchmedo] Don't forget to run the following:"
    echo -e "    \`npm run webpack-dev-watch\`\n"
  fi
)
