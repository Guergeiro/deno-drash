#!/bin/bash

(
  deno_version=$(deno version)
  build_date=$(date)
  export DRASH_DOCS_BASE_URL="/deno-drash"

  echo "Performing production compilation of new webpack bundle.js"

  node_modules/.bin/webpack \
    --env.environment="production" \
    --env.deno_version="$deno_version" \
    --env.base_url="$DRASH_DOCS_BASE_URL" \
    --env.build_date="$build_date" \
    --hide-modules

  echo "Done."

  echo "Performing build using build.ts..."

  deno run --allow-read --allow-write --allow-env $DRASH_DIR_ROOT/docs/console/docs.ts
  deno run --allow-read --allow-write --allow-env $DRASH_DIR_ROOT/docs/console/build.ts

  echo "Done."

  echo "Performing git commit..."

  git add index.html
  git add public/assets/js/bundle.min.js
  git commit -m "npm run build ($(date))"

  echo "Done."

  echo "Performing git push..."

  git push

  echo "Done."
)
