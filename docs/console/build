#!/bin/bash

(
  deno_version=$(deno --version)
  export DRASH_DOCS_BASE_URL="/deno-drash"

  echo "Performing production compilation of new webpack bundle.js"

  webpack \
    --env.environment="production" \
    --env.deno_version="$deno_version" \
    --env.base_url="$DRASH_DOCS_BASE_URL" \
    --hide-modules

  echo "Done."

  echo "Performing build using build.ts..."

  deno $DRASH_DIR_ROOT/docs/console/build.ts \
    --allow-env \
    --allow-read \
    --allow-write

  echo "Done."

  echo "Performing git commit..."

  git add index.html
  git add public/assets/js/bundle.min.js
  git commit -m "npm run build"

  echo "Done."

  echo "Performing git push..."

  git push

  echo "Done."
)
